{% extends 'index.html' %}
{% block  a%}
    <p>如果未注册用户，请先访问注册页面</p>
{% endblock %}

{% block b %}
    <h2 style="color: whitesmoke">用户登录<i style="float: right" class="fa fa-user-o fa-2x"></i></h2>
    <h3 style="color: whitesmoke">填写以下信息，完成登录：</h3>
    <div class="divider" style="float: left; margin-bottom: 10px;width: 100%;height:3px;background: #fff;background: rgba(255, 255, 255, 0.8);"></div>
        <form action="/api/login/">

          <div class="form-group has-error" id="user_form">
            <input required="required" type="text" class="form-control" name="username" placeholder="请输入用户名">
{#                <label class="control-label">用户名不能为空</label>#}
          </div>

          <div class="form-group">
            <input type="password" class="form-control" name="password" placeholder="请输入密码">
          </div>

{#            <button type="submit" id="login" style="font-size: 20px" class="btn btn-success form-control">登录</button>#}
            <a id="login" style="font-size: 20px" class="btn btn-success form-control">登录</a>

        </form>


    <!--ajax实现前端登陆判断功能，不能有submit-->
    <script type="text/javascript">
       {#$("#login").click(function () {#}
       {#     var v=$("input[name='username']").val();#}
       {#     var p=$("input[name='password']").val();#}
       {#     if (v==''){#}
       {#         alert("用户名不能为空")#}
       {#     }#}
       {#     if (p==''){#}
       {#         alert("密码不能为空")#}
       {#     }#}
       {# })#}

{##}
{#        $("input[name='username']").blur(function () {#}
{#            $('#user_form').removeClass('has-error');#}
{#            $('#user_form label').remove();#}
{#            var v=$("input[name='username']").val();#}
{#            if(v==''){#}
{#                $("#user_form").addClass('has-error');#}
{#                $('#user_form').append("<label class=\"control-label user_error_info\">用户名不能为空</label>")#}
{#            }#}
{#        });#}
{#        #}

        $("input[name='username']").blur(function (){
            $('#user_form').removeClass('has-error');
            $('#user_form label').remove();
            var v=$("input[name='username']").val();
            var p=$("input[name='password']").val();
            if(v==''){
                $("#user_form").addClass('has-error');
                $('#user_form').append("<label class=\"control-label user_error_info\">用户名不能为空</label>")
            }else{
                if(v.length<=5 || v.length>10){
                    $("#user_form").addClass('has-error');
                    $('#user_form').append("<label class=\"control-label user_error_info\">用户名在5-10位之间</label>");
                }
            }
        })
        
        {#当用户名和密码都合法时候把数据提交到服务器#}
         $("#login").click(function () {
            var username = $("input[name='username']").val();
            var password = $("input[name='password']").val();
            if (username != '' && password != ''){
                $.post('/api/login/', {username:username, password:password}, function (data) {
                    if (data.flag == 1){
                        window.location.href = '/index/home/?user='+data.username
                    }
                })
            }
        });

    </script>

{% endblock %}